#!/usr/bin/env bash

otp=false

while getopts "o" x; do
  case $x in
    o) otp=true;;
    *) exit 1;; # opts are handled by getopts
  esac
done

if "$otp"; then
  pass="pass otp -c"
  regex="^otp:.+"
else
  pass="pass -c"
  regex="^[^o][^t][^p][^:].+"
fi

store=$(
  fd --regex "$regex" ~/.local/share/password-store -e gpg --format '{.}' |
    sd ~/.local/share/password-store/ '' |
    wofi --show dmenu
)

exec "$pass" "$store"
