#!/usr/bin/env fish

set sessions
zellij list-sessions -n | while read -l line
    echo $line | read -d ' ' session
    set -a sessions $session
end

set session (begin
    printf '%s\n' $sessions
    echo "-New session-"
end | gum choose --height 5 --header "Sessions")

if test $session = "-New session-"
    set session (gum input --header "Session name")
    contains sessions $session && exec zellij attach $session

    set session_name (basename $PWD | sd "[^a-zA-Z0-9]" "-")
    zellij attach -b $session_name
    zellij edit . --width 70%
    zellij action move-pane left
    test -f $PWD/flake.nix && zellij action write-chars "nixd --impure"\n
    exec zellij attach
else
    exec zellij attach $session
end
